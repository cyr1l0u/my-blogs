---
title: Sync.RWMutex
date: 2023-11-02 22:04:07
permalink: /pages/9b64aa/
categories:
  - 语言
  - Go
tags:
  - 
author: 
  name: erlangtui
  link: https://github.com/erlangtui
---

## 一、简述
* RWMutex 是一个读写互斥锁，锁可以被多个读 goroutine 同时拥有或被单个写 goroutine 拥有，但不能同时被读写 goroutine 拥有，即：写写互斥、写读互斥，只有读读是不互斥的；
* RWMutex 的零值是解锁的互斥锁，在首次使用后不得复制；
* RWMutex 适合读多写少的情况；

## 二、基本原理
* 写 goroutine 获取锁后会阻止其他写 goroutine 继续获得锁，这是通过互斥锁实现的，同时还会阻止其他读 goroutine 获得锁，此时读 goroutine 只能继续等待，直到该写 goroutine 释放锁，如果此时再来写 goroutine 尝试获取锁，只能排在这些读 goroutine 之后；
* 读 goroutine 获取锁后其他读 goroutine 能继续获得锁，会阻止写 goroutine 获得锁，此时写 goroutine 只能继续等待，直到这些读 goroutine 释放锁，如果此时再来读 goroutine ，只能排在这些写 goroutine 之后；

## 三、基本用法
```go
var m sync.RWMutex
var val int

func GetVal() int {
	m.RLock()
	defer m.RUnlock()
	return val
}

func SetVal(v int) {
	m.Lock()
	val = v
	m.Unlock()
}
```
* 分别可以在不同的 goroutine 中调用上述 `GetVal()`函数和`SetVal(v int)`，用于获取或修改 `val`变量；

## 四、源码解读
### 1，RWMutex
```go

```

### 2，Lock()
:::details
```go

```
:::

### 3, UnLock()
:::details
```go


```
:::

### 4，RLock()
:::details
```go

```
:::

### 5, RUnLock()
:::details
```go


```
:::
### 6, Locker
```go
```
---
title: 函数选项模式
date: 2024-04-01 16:42:24
permalink: /pages/5a5425/
categories:
  - 语言
  - Go
tags:
  - 
author: 
  name: erlangtui
  link: https://github.com/erlangtui
---


::: details
```go
package main

import (
	"errors"
	"fmt"
)

type options struct {
	name    string
	age     int
	dealFun func() error
}

// 表示更新配置结构体的函数类型
type Option func(*options) error

// 该函数返回一个闭包，引用其外部的变量，并进行校验
func WithName(name string) Option {
	return func(opts *options) error {
		if name == "" {
			return errors.New("name is null")
		}
		opts.name = name
		return nil
	}
}

func WithAge(age int) Option {
	return func(opts *options) error {
		if age < 0 {
			return errors.New("age less than 0")
		}
		opts.age = age
		return nil
	}
}

func WithDealFun(f func() error) Option {
	return func(opts *options) error {
		if f == nil {
			return errors.New("f is nil")
		}
		opts.dealFun = f
		return nil
	}
}

func InitOptions(opts ...Option) error {
	// 初始化选项
	op := options{}

	// 应用选项
	for _, opt := range opts {
		if err := opt(&op); err != nil {
			return err
		}
	}
	return nil
}

func f() error {
	// do something
	return nil
}

func main() {
	err := InitOptions(WithName("go"), WithAge(18), WithDealFun(f))
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println("succeed init")
}
```
:::